<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Custom Summaries - Chorus by ZoomInfo</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Custom styles */
    .chorus-logo {
      color: #1976D2;
    }
    
    .chorus-waveform {
      fill: #1976D2;
    }
    
    /* User dropdown styles */
    .user-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      margin-top: 0.5rem;
      width: 240px;
      background-color: white;
      border-radius: 0.5rem;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      z-index: 50;
      overflow: hidden;
      display: none;
    }
    
    .user-dropdown.active {
      display: block;
    }
    
    .user-dropdown-header {
      padding: 1rem;
      border-bottom: 1px solid #E5E7EB;
    }
    
    .user-dropdown-item {
      display: flex;
      align-items: center;
      padding: 0.75rem 1rem;
      color: #374151;
      transition: background-color 0.2s;
    }
    
    .user-dropdown-item:hover {
      background-color: #F3F4F6;
    }
    
    .user-dropdown-item svg {
      margin-right: 0.75rem;
    }

    /* Settings sidebar styles */
    .settings-sidebar {
      width: 250px;
      border-right: 1px solid #E5E7EB;
    }

    .settings-nav-item {
      display: flex;
      align-items: center;
      padding: 0.75rem 1rem;
      color: #374151;
      transition: background-color 0.2s;
      border-radius: 0.25rem;
      margin-bottom: 0.25rem;
    }

    .settings-nav-item:hover {
      background-color: #F3F4F6;
    }

    .settings-nav-item.active {
      background-color: #E3F2FD;
      color: #1976D2;
      font-weight: 500;
    }

    .settings-nav-item-child {
      padding-left: 2.5rem;
    }

    /* Settings content styles */
    .settings-section {
      margin-bottom: 2.5rem;
      padding-bottom: 2.5rem;
      border-bottom: 1px solid #E5E7EB;
    }

    .settings-section:last-child {
      border-bottom: none;
    }

    .settings-section-title {
      font-size: 1.25rem;
      font-weight: 500;
      margin-bottom: 1rem;
      color: #111827;
    }

    .settings-section-description {
      color: #4B5563;
      margin-bottom: 1.5rem;
      max-width: 42rem;
    }

    .create-button {
      background-color: #1976D2;
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 0.375rem;
      font-weight: 500;
      transition: background-color 0.2s;
    }

    .create-button:hover {
      background-color: #1565C0;
    }

    /* Table styles */
    .summaries-table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 0.5rem;
      overflow: hidden;
      box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
    }

    .summaries-table th {
      background-color: #F9FAFB;
      padding: 0.75rem 1rem;
      text-align: left;
      font-weight: 500;
      color: #374151;
      border-bottom: 1px solid #E5E7EB;
      font-size: 0.875rem;
    }

    .summaries-table td {
      padding: 1rem;
      border-bottom: 1px solid #E5E7EB;
      vertical-align: middle;
    }

    .summaries-table tr:last-child td {
      border-bottom: none;
    }

    .summaries-table tr:hover {
      background-color: #F9FAFB;
    }

    .summary-name {
      font-weight: 500;
      color: #111827;
      margin-bottom: 0.25rem;
    }

    .summary-description {
      color: #6B7280;
      font-size: 0.875rem;
    }

    .status-cell {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      justify-content: flex-end;
    }

    .edit-link {
      color: #1976D2;
      font-weight: 500;
      text-decoration: none;
      font-size: 0.875rem;
    }

    .edit-link:hover {
      text-decoration: underline;
    }

    /* Toggle switch styles */
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 44px;
      height: 24px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #1976D2;
      transition: 0.3s;
      border-radius: 24px;
    }

    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: 0.3s;
      border-radius: 50%;
    }

    .toggle-switch input:checked + .toggle-slider {
      background-color: #1976D2;
    }

    .toggle-switch input:checked + .toggle-slider:before {
      transform: translateX(20px);
    }

    .toggle-switch input:not(:checked) + .toggle-slider {
      background-color: #D1D5DB;
    }

    .empty-state {
      text-align: center;
      padding: 3rem 1rem;
      color: #6B7280;
    }

    .empty-state-icon {
      width: 48px;
      height: 48px;
      margin: 0 auto 1rem;
      color: #D1D5DB;
    }

    /* Modal styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 50;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 2rem;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal-content {
      background: white;
      border-radius: 12px;
      width: 100%;
      max-width: 800px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    }

    .modal-header {
      padding: 1.5rem 2rem;
      border-bottom: 1px solid #E5E7EB;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .modal-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: #111827;
    }

    .modal-close {
      width: 32px;
      height: 32px;
      border-radius: 6px;
      border: none;
      background: #F3F4F6;
      color: #6B7280;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .modal-close:hover {
      background: #E5E7EB;
      color: #374151;
    }

    .modal-body {
      padding: 2rem;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-label {
      display: block;
      font-size: 0.875rem;
      font-weight: 500;
      color: #374151;
      margin-bottom: 0.5rem;
    }

    .form-input {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #D1D5DB;
      border-radius: 0.375rem;
      font-size: 0.875rem;
      transition: border-color 0.2s ease;
    }

    .form-input:focus {
      outline: none;
      border-color: #1976D2;
      box-shadow: 0 0 0 3px rgba(25, 118, 210, 0.1);
    }

    .form-textarea {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #D1D5DB;
      border-radius: 0.375rem;
      font-size: 0.875rem;
      min-height: 120px;
      resize: vertical;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      transition: border-color 0.2s ease;
    }

    .form-textarea:focus {
      outline: none;
      border-color: #1976D2;
      box-shadow: 0 0 0 3px rgba(25, 118, 210, 0.1);
    }

    .form-select {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #D1D5DB;
      border-radius: 0.375rem;
      font-size: 0.875rem;
      background: white;
      transition: border-color 0.2s ease;
    }

    .form-select:focus {
      outline: none;
      border-color: #1976D2;
      box-shadow: 0 0 0 3px rgba(25, 118, 210, 0.1);
    }

    .test-prompt-section {
      display: flex;
      gap: 1rem;
      align-items: flex-start;
    }

    .test-button {
      background-color: #F3F4F6;
      color: #374151;
      padding: 0.75rem 1rem;
      border: 1px solid #D1D5DB;
      border-radius: 0.375rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      white-space: nowrap;
    }

    .test-button:hover {
      background-color: #E5E7EB;
    }

    .test-results {
      margin-top: 1rem;
      padding: 1rem;
      background: #F9FAFB;
      border: 1px solid #E5E7EB;
      border-radius: 0.375rem;
      font-size: 0.875rem;
      color: #374151;
      display: none;
    }

    .test-results.active {
      display: block;
    }

    .modal-footer {
      padding: 1.5rem 2rem;
      border-top: 1px solid #E5E7EB;
      display: flex;
      justify-content: flex-end;
      gap: 1rem;
    }

    .btn-secondary {
      background-color: #F3F4F6;
      color: #374151;
      padding: 0.75rem 1.5rem;
      border: 1px solid #D1D5DB;
      border-radius: 0.375rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-secondary:hover {
      background-color: #E5E7EB;
    }

    .btn-primary {
      background-color: #1976D2;
      color: white;
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 0.375rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary:hover {
      background-color: #1565C0;
    }

    .btn-primary:disabled {
      background-color: #D1D5DB;
      cursor: not-allowed;
    }

    /* Trigger condition styles */
    .trigger-condition {
      background: #F9FAFB;
      border: 1px solid #E5E7EB;
      border-radius: 0.5rem;
      padding: 1rem;
      margin-bottom: 1rem;
      position: relative;
    }

    .trigger-condition-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .trigger-condition-title {
      font-weight: 500;
      color: #374151;
      font-size: 0.875rem;
    }

    .trigger-remove-btn {
      background: #FEE2E2;
      color: #DC2626;
      border: 1px solid #FECACA;
      border-radius: 0.25rem;
      padding: 0.25rem 0.5rem;
      font-size: 0.75rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .trigger-remove-btn:hover {
      background: #FECACA;
    }

    .trigger-condition-row {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr 2fr;
      gap: 0.75rem;
      align-items: end;
    }

    .trigger-logic-operator {
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0.5rem 0;
      gap: 0.5rem;
    }

    .logic-operator-btn {
      background: #F3F4F6;
      border: 1px solid #D1D5DB;
      border-radius: 0.25rem;
      padding: 0.5rem 1rem;
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }

    .logic-operator-btn.active {
      background: #1976D2;
      color: white;
      border-color: #1976D2;
    }

    .logic-operator-btn:hover:not(.active) {
      background: #E5E7EB;
    }

    .trigger-empty-state {
      text-align: center;
      padding: 2rem;
      color: #6B7280;
      background: #F9FAFB;
      border: 2px dashed #D1D5DB;
      border-radius: 0.5rem;
    }

    .trigger-empty-state-icon {
      width: 32px;
      height: 32px;
      margin: 0 auto 0.5rem;
      color: #D1D5DB;
    }

    .form-input-small {
      width: 100%;
      padding: 0.5rem;
      border: 1px solid #D1D5DB;
      border-radius: 0.25rem;
      font-size: 0.875rem;
      transition: border-color 0.2s ease;
    }

    .form-input-small:focus {
      outline: none;
      border-color: #1976D2;
      box-shadow: 0 0 0 2px rgba(25, 118, 210, 0.1);
    }

    .form-select-small {
      width: 100%;
      padding: 0.5rem;
      border: 1px solid #D1D5DB;
      border-radius: 0.25rem;
      font-size: 0.875rem;
      background: white;
      transition: border-color 0.2s ease;
    }

    .form-select-small:focus {
      outline: none;
      border-color: #1976D2;
      box-shadow: 0 0 0 2px rgba(25, 118, 210, 0.1);
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen">
  <!-- Header -->
  <header class="border-b border-gray-200 bg-white">
    <div class="flex items-center justify-between px-4 py-2">
      <div class="flex items-center">
        <a href="/" class="flex items-center mr-8">
          <img src="/public/chorus-logo.svg" class="chorus-waveform" width="24" height="24" alt="Chorus">
          <span class="ml-2 text-xl font-semibold chorus-logo">Chorus</span>
        </a>
        
        <nav class="hidden md:flex space-x-8">
          <a href="/" class="text-gray-600 hover:text-blue-600 py-4 font-medium">
            Home
          </a>
          <a href="#" class="text-gray-600 hover:text-blue-600 py-4 font-medium">
            Engagements
          </a>
          <a href="#" class="text-gray-600 hover:text-blue-600 py-4 font-medium">
            Deals
          </a>
          <a href="#" class="text-gray-600 hover:text-blue-600 py-4 font-medium">
            Playlists
          </a>
          <div class="relative group">
            <button class="text-gray-600 hover:text-blue-600 py-4 font-medium flex items-center">
              More
              <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
              </svg>
            </button>
          </div>
        </nav>
      </div>
      
      <div class="flex items-center">
        <div class="relative mr-4">
          <div class="flex items-center border rounded-md px-3 py-1.5 bg-gray-50">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
            <input
              type="text"
              placeholder="Search in Chorus"
              class="ml-2 bg-transparent outline-none text-sm w-40 md:w-60"
            />
            <button class="ml-2 text-gray-400 border-l pl-2">
              Options
            </button>
          </div>
        </div>
        
        <div class="flex items-center relative">
          <button id="user-menu-button" class="w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center text-sm font-medium text-white">
            GP
          </button>
          
          <!-- User dropdown menu -->
          <div id="user-dropdown" class="user-dropdown">
            <div class="user-dropdown-header">
              <div class="font-medium">Gabe Pirela</div>
            </div>
            <a href="personal-settings.html" class="user-dropdown-item">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
              </svg>
              Settings
            </a>
            <a href="#" class="user-dropdown-item">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
              </svg>
              Help Center
            </a>
            <a href="#" class="user-dropdown-item">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
              </svg>
              Live Chat
            </a>
            <a href="#" class="user-dropdown-item">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
              </svg>
              Log Out
            </a>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <div class="flex min-h-screen">
    <!-- Settings Sidebar -->
    <div class="settings-sidebar p-4 bg-white">
      <div class="settings-nav-item">
        <a href="personal-settings.html" class="block w-full">Personal Settings</a>
      </div>
      <div class="settings-nav-item">
        User Management
      </div>
      <div class="settings-nav-item-child">
        Users
      </div>
      <div class="settings-nav-item-child">
        Teams and Data Access
      </div>
      <div class="settings-nav-item-child">
        Roles and Permissions
      </div>
      <div class="settings-nav-item">
        Integrations
      </div>
      <div class="settings-nav-item">
        Organization Settings
      </div>
      <div class="settings-nav-item">
        Trackers
      </div>
      <div class="settings-nav-item">
        Signals
      </div>
      <div class="settings-nav-item active">
        <a href="custom-summaries.html" class="block w-full">Custom Summaries</a>
      </div>
    </div>

    <!-- Settings Content -->
    <div class="flex-1 p-8">
      <!-- Header Section -->
      <div class="flex justify-between items-start mb-8">
        <div>
          <h1 class="text-2xl font-semibold text-gray-900 mb-2">Custom Summaries</h1>
          <p class="text-gray-600 max-w-2xl">
            Create custom AI-powered summaries for your meetings. Define specific prompts to extract the information that matters most to your team and workflow.
          </p>
        </div>
        <a href="create-custom-summary.html" class="create-button" style="text-decoration: none; display: inline-block;">
          Create Custom Summary
        </a>
      </div>

      <!-- Custom Summaries Table -->
      <table class="summaries-table">
        <thead>
          <tr>
            <th style="width: 25%;">Summary Name</th>
            <th style="width: 50%;">Description</th>
            <th style="width: 25%; text-align: right;">Status (2 Active)</th>
          </tr>
        </thead>
        <tbody>
          <tr data-summary-id="1">
            <td>
              <div class="summary-name">Sales Discovery Summary</div>
            </td>
            <td>
              <div class="summary-description">Extracts key pain points, budget information, and decision-making process</div>
            </td>
            <td>
              <div class="status-cell">
                <a href="#" class="edit-link" onclick="editSummary(1); return false;">Edit</a>
                <label class="toggle-switch">
                  <input type="checkbox" checked>
                  <span class="toggle-slider"></span>
                </label>
              </div>
            </td>
          </tr>
          <tr data-summary-id="6">
            <td>
              <div class="summary-name">Sandler Sales Methodology</div>
            </td>
            <td>
              <div class="summary-description">Comprehensive analysis of sales meetings using Sandler submarine framework, qualification principles, and systematic selling approach</div>
            </td>
            <td>
              <div class="status-cell">
                <a href="#" class="edit-link" onclick="editSummary(6); return false;">Edit</a>
                <label class="toggle-switch">
                  <input type="checkbox" checked>
                  <span class="toggle-slider"></span>
                </label>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Create Custom Summary Modal -->
  <div id="createModal" class="modal-overlay">
    <div class="modal-content">
      <!-- Modal Header -->
      <div class="modal-header">
        <h2 class="modal-title">Create Custom Summary</h2>
        <button class="modal-close" onclick="closeCreateModal()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>

      <!-- Modal Body -->
      <div class="modal-body">
        <form id="createSummaryForm">
          <!-- Name Field -->
          <div class="form-group">
            <label class="form-label" for="summaryName">Summary Name *</label>
            <input 
              type="text" 
              id="summaryName" 
              class="form-input" 
              placeholder="e.g., Sales Discovery Summary"
              required
            >
          </div>

          <!-- Description Field -->
          <div class="form-group">
            <label class="form-label" for="summaryDescription">Description *</label>
            <input 
              type="text" 
              id="summaryDescription" 
              class="form-input" 
              placeholder="Brief description of what this summary extracts"
              required
            >
          </div>

          <!-- Custom Prompt Field -->
          <div class="form-group">
            <label class="form-label" for="customPrompt">Custom Prompt *</label>
            <div class="test-prompt-section">
              <textarea 
                id="customPrompt" 
                class="form-textarea" 
                placeholder="Analyze this meeting and provide:

1. **Key Topics Discussed:**
   - List the main topics covered
   - Include specific details mentioned

2. **Action Items:**
   - Who is responsible for what
   - Timeline for completion

3. **Next Steps:**
   - Follow-up meetings scheduled
   - Decisions that need to be made"
                required
              ></textarea>
              <button type="button" class="test-button" onclick="testPrompt()">Test Prompt</button>
            </div>
            
            <!-- Test Results -->
            <div id="testResults" class="test-results">
              <strong>Test Results:</strong><br>
              <div id="testOutput">Click "Test Prompt" to see how your prompt works with sample meeting data.</div>
            </div>
          </div>

          <!-- Salesforce Object Field -->
          <div class="form-group">
            <label class="form-label" for="salesforceObject">Salesforce Object</label>
            <select id="salesforceObject" class="form-select" onchange="updateSalesforceFields()">
              <option value="">Select Salesforce Object (Optional)</option>
              <option value="Account">Account</option>
              <option value="Opportunity">Opportunity</option>
              <option value="Event">Event</option>
              <option value="Task">Task</option>
            </select>
          </div>

          <!-- Salesforce Field Field -->
          <div class="form-group" id="salesforceFieldGroup" style="display: none;">
            <label class="form-label" for="salesforceField">Salesforce Field</label>
            <select id="salesforceField" class="form-select">
              <option value="">Select Field</option>
            </select>
          </div>

          <!-- Triggers Section -->
          <div class="form-group">
            <label class="form-label">Triggers</label>
            <p class="text-sm text-gray-600 mb-3">Configure when this custom summary should run based on CRM data conditions.</p>
            
            <div id="triggersContainer">
              <div class="triggers-header mb-3">
                <button type="button" class="btn-secondary" onclick="addTriggerCondition()">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 0.5rem;">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                  </svg>
                  Add Trigger Condition
                </button>
              </div>
              
              <div id="triggerConditions">
                <!-- Trigger conditions will be dynamically added here -->
              </div>
            </div>
          </div>
        </form>
      </div>

      <!-- Modal Footer -->
      <div class="modal-footer">
        <button type="button" class="btn-secondary" onclick="closeCreateModal()">Cancel</button>
        <button type="button" class="btn-primary" onclick="saveSummary()">Create Summary</button>
      </div>
    </div>
  </div>

  <script>
    // Global storage for summaries
    let summaries = {
      1: {
        id: 1,
        name: 'Sales Discovery Summary',
        description: 'Extracts key pain points, budget information, and decision-making process',
        prompt: `Analyze this sales discovery call and provide:

1. **Pain Points Identified:**
   - List the main challenges or problems the prospect mentioned
   - Include specific quotes when possible

2. **Budget & Timeline:**
   - Any budget ranges or constraints discussed
   - Timeline for implementation or decision-making

3. **Decision Making Process:**
   - Who are the key stakeholders involved?
   - What is their evaluation process?
   - Any competitors mentioned?

4. **Next Steps:**
   - Agreed upon follow-up actions
   - Information requested by prospect`,
        salesforceObject: 'Opportunity',
        salesforceField: 'Description',
        slackDelivery: true,
        active: true
      },
      6: {
        id: 6,
        name: 'Sandler Sales Methodology',
        description: 'Comprehensive analysis of sales meetings using Sandler submarine framework, qualification principles, and systematic selling approach',
        prompt: `Instructions
You are an expert Sandler sales methodology analyst tasked with creating a comprehensive summary of a meeting transcript through the lens of the Sandler selling system. Extract and organize information according to Sandler principles, focusing on qualification, mutual commitment, and the systematic progression through the Sandler submarine.

Generate a Detailed summary of this meeting transcript.

Sandler Summary Structure:

1. Meeting Metadata
- Meeting Type: [Initial prospect/Qualification/Pain development/Budget discussion/Decision mapping/Fulfillment/Post-sell]
- Sandler Submarine Position: [Which compartment(s) were the primary focus]
- Date & Time: [Extract from transcript]
- Participants: [List with Sandler roles and decision-making authority]

2. Sandler Methodology Assessment
Comprehensive analysis of Sandler methodology execution throughout the meeting. Evaluate the systematic progression through submarine compartments, assess questioning techniques, analyze talk/listen ratios, and identify well-executed principles or missed opportunities.

3. Bonding & Rapport Analysis (Compartment 1)
Detailed analysis of relationship building, communication style matching, trust development, and comfort level establishment with supporting examples.

4. Up-Front Contract Evaluation (Compartment 2)
Evaluate meeting objectives agreement, expectation clarity, permission-seeking for difficult topics, and mutual commitment establishment.

5. Pain Development & Qualification (Compartments 3-4)
Document systematic progression from surface issues to underlying business pains, evaluate questioning effectiveness, analyze emotional impact development, and assess prospect's pain ownership.

6. Budget Qualification Analysis (Compartment 5)
Analyze money conversation handling, budget parameter discovery, investment vs cost mentality discussion, and value-based pricing conversations.

7. Decision Process Mapping (Compartment 6)
Evaluate decision authority qualification, stakeholder identification, decision criteria discovery, timeline establishment, and obstacle identification.

8. Post-Sell & Commitment Analysis
Analyze mutual commitment establishment, next steps clarity, accountability measures, and sales process momentum maintenance.

9. Action Items & Next Steps
Organize follow-up tasks within Sandler framework progression, analyze mutual commitment levels, and assess sales process control maintenance.

10. Sandler Opportunity Assessment
Evaluate qualification status using Sandler standards, assess relationship strength, identify obstacles, and provide strategic recommendations for advancing through remaining submarine compartments.

Evaluate every interaction through the Sandler submarine framework, focus on qualification over presentation, assess emotional and logical pain development, and provide coaching recommendations for methodology improvement.`,
        salesforceObject: 'Opportunity',
        salesforceField: 'Meeting_Summary__c',
        structuredOutputs: [
          {
            name: 'Pain',
            extractionPrompt: 'Extract pain points, challenges, and problems that need solving. Focus on emotional and business impact, urgency, and consequences of inaction using Sandler pain development principles.',
            object: 'Opportunity',
            field: 'Pain_Points__c',
            writebackMode: 'append',
            overwriteBehavior: 'always'
          },
          {
            name: 'Budget',
            extractionPrompt: 'Identify budget discussions, financial capacity, and investment appetite. Include budget ranges, funding availability, and financial decision-making process using Sandler money conversation techniques.',
            object: 'Opportunity',
            field: 'Budget_Info__c',
            writebackMode: 'append',
            overwriteBehavior: 'always'
          },
          {
            name: 'Decision',
            extractionPrompt: 'Extract decision-making process, criteria, and stakeholders involved. Include who makes decisions, evaluation criteria, and approval process using Sandler decision qualification methods.',
            object: 'Opportunity',
            field: 'Decision_Process__c',
            writebackMode: 'append',
            overwriteBehavior: 'always'
          },
          {
            name: 'Timeline',
            extractionPrompt: 'Identify timeline expectations, deadlines, and urgency indicators. Include decision timeline, implementation schedule, and time-sensitive factors using Sandler qualification principles.',
            object: 'Opportunity',
            field: 'Timeline__c',
            writebackMode: 'append',
            overwriteBehavior: 'always'
          }
        ],
        slackDelivery: true,
        active: true
      }
    };

    // Current editing state
    let currentEditingId = null;

    // User dropdown toggle functionality
    document.addEventListener('DOMContentLoaded', function() {
      const userMenuButton = document.getElementById('user-menu-button');
      const userDropdown = document.getElementById('user-dropdown');
      
      // Toggle dropdown when clicking the user menu button
      userMenuButton.addEventListener('click', function(e) {
        e.stopPropagation();
        userDropdown.classList.toggle('active');
      });
      
      // Close dropdown when clicking outside
      document.addEventListener('click', function(e) {
        if (!userMenuButton.contains(e.target) && !userDropdown.contains(e.target)) {
          userDropdown.classList.remove('active');
        }
      });
    });

    // Modal functionality
    function openCreateModal(summaryData = null) {
      const modal = document.getElementById('createModal');
      const modalTitle = document.querySelector('.modal-title');
      const saveButton = document.querySelector('.btn-primary');
      
      modal.classList.add('active');
      
      if (summaryData) {
        // Edit mode
        modalTitle.textContent = 'Edit Custom Summary';
        saveButton.textContent = 'Update Summary';
        currentEditingId = summaryData.id;
        
        // Pre-fill form with existing data
        document.getElementById('summaryName').value = summaryData.name;
        document.getElementById('summaryDescription').value = summaryData.description;
        document.getElementById('customPrompt').value = summaryData.prompt;
        document.getElementById('salesforceObject').value = summaryData.salesforceObject || '';
        
        // Trigger field update for Salesforce fields
        updateSalesforceFields();
        
        // Set Salesforce field after fields are populated
        setTimeout(() => {
          document.getElementById('salesforceField').value = summaryData.salesforceField || '';
        }, 100);
        
        // Load trigger conditions
        setTimeout(() => {
          setTriggerConditions(summaryData.triggers || []);
        }, 200);
      } else {
        // Create mode
        modalTitle.textContent = 'Create Custom Summary';
        saveButton.textContent = 'Create Summary';
        currentEditingId = null;
        
        // Reset form
        document.getElementById('createSummaryForm').reset();
        document.getElementById('salesforceFieldGroup').style.display = 'none';
        
        // Reset triggers
        setTriggerConditions([]);
      }
      
      document.getElementById('testResults').classList.remove('active');
    }

    // Edit summary function
    function editSummary(summaryId) {
      const summaryData = summaries[summaryId];
      if (summaryData) {
        // Store the summary data in localStorage for the edit page
        localStorage.setItem('editingSummary', JSON.stringify(summaryData));
        // Redirect to the create page in edit mode
        window.location.href = `create-custom-summary.html?edit=${summaryId}`;
      } else {
        alert('Summary not found.');
      }
    }

    function closeCreateModal() {
      const modal = document.getElementById('createModal');
      modal.classList.remove('active');
    }

    // Close modal when clicking outside
    document.getElementById('createModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeCreateModal();
      }
    });

    // Prevent modal from closing when clicking inside
    document.querySelector('.modal-content').addEventListener('click', function(e) {
      e.stopPropagation();
    });

    // Test prompt functionality
    function testPrompt() {
      const prompt = document.getElementById('customPrompt').value;
      const testResults = document.getElementById('testResults');
      const testOutput = document.getElementById('testOutput');
      
      if (!prompt.trim()) {
        alert('Please enter a custom prompt first.');
        return;
      }
      
      // Show loading state
      testOutput.innerHTML = 'Testing prompt with sample meeting data...';
      testResults.classList.add('active');
      
      // Simulate API call with sample data
      setTimeout(() => {
        const sampleResult = `
<strong>Sample Output:</strong><br><br>

<strong>1. Key Topics Discussed:</strong><br>
• Product roadmap and upcoming features<br>
• Integration requirements with existing systems<br>
• Pricing structure for enterprise package<br>
• Timeline for implementation (Q2 2024)<br><br>

<strong>2. Action Items:</strong><br>
• John Smith to send technical specifications by Friday<br>
• Sarah Johnson to prepare pricing proposal by next week<br>
• Schedule follow-up demo for decision makers<br><br>

<strong>3. Next Steps:</strong><br>
• Technical deep-dive meeting scheduled for March 15th<br>
• Budget approval needed from finance team<br>
• Final decision expected by end of month<br><br>

<em>Note: This is a sample output based on your prompt structure. Actual results will vary based on meeting content.</em>
        `;
        
        testOutput.innerHTML = sampleResult;
      }, 1500);
    }

    // Save summary functionality
    function saveSummary() {
      const form = document.getElementById('createSummaryForm');
      const name = document.getElementById('summaryName').value;
      const description = document.getElementById('summaryDescription').value;
      const prompt = document.getElementById('customPrompt').value;
      const salesforceObject = document.getElementById('salesforceObject').value;
      const salesforceField = document.getElementById('salesforceField').value;
      const triggers = getTriggerConditions();
      
      // Validate required fields
      if (!name.trim() || !description.trim() || !prompt.trim()) {
        alert('Please fill in all required fields (Name, Description, and Custom Prompt).');
        return;
      }
      
      // Validate Salesforce field if object is selected
      if (salesforceObject && !salesforceField) {
        alert('Please select a Salesforce field for the selected object.');
        return;
      }
      
      if (currentEditingId) {
        // Edit mode - update existing summary
        const existingSummary = summaries[currentEditingId];
        if (existingSummary) {
          // Update the summary data
          summaries[currentEditingId] = {
            ...existingSummary,
            name: name.trim(),
            description: description.trim(),
            prompt: prompt.trim(),
            salesforceObject: salesforceObject,
            salesforceField: salesforceField,
            triggers: triggers
          };
          
          // Update the table row
          updateSummaryInTable(currentEditingId, summaries[currentEditingId]);
          
          // Show success message
          let successMessage = 'Custom summary updated successfully!';
          if (salesforceObject && salesforceField) {
            successMessage += ` It will write to ${salesforceObject}.${salesforceField}.`;
          }
          if (triggers.length > 0) {
            successMessage += ` Configured with ${triggers.length} trigger condition${triggers.length > 1 ? 's' : ''}.`;
          }
          alert(successMessage);
        }
      } else {
        // Create mode - add new summary
        const newId = Date.now();
        const newSummary = {
          name: name.trim(),
          description: description.trim(),
          prompt: prompt.trim(),
          salesforceObject: salesforceObject,
          salesforceField: salesforceField,
          triggers: triggers,
          active: true,
          id: newId
        };
        
        // Add to summaries storage
        summaries[newId] = newSummary;
        
        // Add to table
        addSummaryToTable(newSummary);
        
        // Show success message
        let successMessage = 'Custom summary created successfully!';
        if (salesforceObject && salesforceField) {
          successMessage += ` It will write to ${salesforceObject}.${salesforceField}.`;
        }
        if (triggers.length > 0) {
          successMessage += ` Configured with ${triggers.length} trigger condition${triggers.length > 1 ? 's' : ''}.`;
        }
        alert(successMessage);
      }
      
      // Close modal
      closeCreateModal();
    }

    // Add summary to table
    function addSummaryToTable(summary) {
      const tableBody = document.querySelector('.summaries-table tbody');
      const newRow = document.createElement('tr');
      
      newRow.setAttribute('data-summary-id', summary.id);
      newRow.innerHTML = `
        <td>
          <div class="summary-name">${summary.name}</div>
        </td>
        <td>
          <div class="summary-description">${summary.description}</div>
        </td>
        <td>
          <div class="status-cell">
            <a href="#" class="edit-link" onclick="editSummary(${summary.id}); return false;">Edit</a>
            <label class="toggle-switch">
              <input type="checkbox" ${summary.active ? 'checked' : ''}>
              <span class="toggle-slider"></span>
            </label>
          </div>
        </td>
      `;
      
      tableBody.appendChild(newRow);
      
      // Update active count in header
      updateActiveCount();
    }

    // Update summary in table
    function updateSummaryInTable(summaryId, summary) {
      const row = document.querySelector(`tr[data-summary-id="${summaryId}"]`);
      if (row) {
        const nameCell = row.querySelector('.summary-name');
        const descriptionCell = row.querySelector('.summary-description');
        
        if (nameCell) nameCell.textContent = summary.name;
        if (descriptionCell) descriptionCell.textContent = summary.description;
      }
    }

    // Update active count in table header
    function updateActiveCount() {
      const activeToggles = document.querySelectorAll('.summaries-table input[type="checkbox"]:checked');
      const headerCell = document.querySelector('.summaries-table th:last-child');
      headerCell.textContent = `Status (${activeToggles.length} Active)`;
    }

    // Salesforce field mappings
    const salesforceFieldMappings = {
      'Account': [
        { value: 'Description', label: 'Description' },
        { value: 'Notes__c', label: 'Notes' },
        { value: 'Meeting_Summary__c', label: 'Meeting Summary' },
        { value: 'Last_Call_Notes__c', label: 'Last Call Notes' }
      ],
      'Opportunity': [
        { value: 'Description', label: 'Description' },
        { value: 'Next_Steps__c', label: 'Next Steps' },
        { value: 'Meeting_Summary__c', label: 'Meeting Summary' },
        { value: 'Call_Notes__c', label: 'Call Notes' }
      ],
      'Event': [
        { value: 'Description', label: 'Description' },
        { value: 'Comments__c', label: 'Comments' },
        { value: 'Meeting_Notes__c', label: 'Meeting Notes' },
        { value: 'Summary__c', label: 'Summary' }
      ],
      'Task': [
        { value: 'Description', label: 'Description' },
        { value: 'Comments__c', label: 'Comments' },
        { value: 'Call_Summary__c', label: 'Call Summary' },
        { value: 'Notes__c', label: 'Notes' }
      ]
    };

    // Update Salesforce fields based on selected object
    function updateSalesforceFields() {
      const objectSelect = document.getElementById('salesforceObject');
      const fieldSelect = document.getElementById('salesforceField');
      const fieldGroup = document.getElementById('salesforceFieldGroup');
      
      const selectedObject = objectSelect.value;
      
      if (selectedObject && salesforceFieldMappings[selectedObject]) {
        // Show the field group
        fieldGroup.style.display = 'block';
        
        // Clear existing options
        fieldSelect.innerHTML = '<option value="">Select Field</option>';
        
        // Add fields for selected object
        salesforceFieldMappings[selectedObject].forEach(field => {
          const option = document.createElement('option');
          option.value = field.value;
          option.textContent = field.label;
          fieldSelect.appendChild(option);
        });
      } else {
        // Hide the field group
        fieldGroup.style.display = 'none';
        fieldSelect.innerHTML = '<option value="">Select Field</option>';
      }
    }

    // Trigger condition management
    let triggerConditionCounter = 0;

    // Operator options for different field types
    const operatorOptions = {
      'text': [
        { value: 'equals', label: 'Equals' },
        { value: 'not_equals', label: 'Not Equals' },
        { value: 'contains', label: 'Contains' },
        { value: 'not_contains', label: 'Does Not Contain' },
        { value: 'starts_with', label: 'Starts With' },
        { value: 'ends_with', label: 'Ends With' }
      ],
      'number': [
        { value: 'equals', label: 'Equals' },
        { value: 'not_equals', label: 'Not Equals' },
        { value: 'greater_than', label: 'Greater Than' },
        { value: 'less_than', label: 'Less Than' },
        { value: 'greater_equal', label: 'Greater Than or Equal' },
        { value: 'less_equal', label: 'Less Than or Equal' }
      ],
      'boolean': [
        { value: 'equals', label: 'Equals' }
      ],
      'date': [
        { value: 'equals', label: 'Equals' },
        { value: 'not_equals', label: 'Not Equals' },
        { value: 'after', label: 'After' },
        { value: 'before', label: 'Before' }
      ]
    };

    // Add trigger condition
    function addTriggerCondition() {
      const conditionsContainer = document.getElementById('triggerConditions');
      const conditionId = ++triggerConditionCounter;
      
      // Check if this is the first condition
      const isFirstCondition = conditionsContainer.children.length === 0;
      
      // Create condition HTML
      const conditionHTML = `
        <div class="trigger-condition" data-condition-id="${conditionId}">
          <div class="trigger-condition-header">
            <span class="trigger-condition-title">Condition ${conditionId}</span>
            <button type="button" class="trigger-remove-btn" onclick="removeTriggerCondition(${conditionId})">
              Remove
            </button>
          </div>
          
          <div class="trigger-condition-row">
            <div>
              <label class="form-label" style="margin-bottom: 0.25rem;">CRM Object</label>
              <select class="form-select-small" onchange="updateTriggerFields(${conditionId})">
                <option value="">Select Object</option>
                <option value="Account">Account</option>
                <option value="Opportunity">Opportunity</option>
                <option value="Event">Event</option>
                <option value="Task">Task</option>
                <option value="Contact">Contact</option>
                <option value="Lead">Lead</option>
              </select>
            </div>
            
            <div>
              <label class="form-label" style="margin-bottom: 0.25rem;">Field</label>
              <select class="form-select-small trigger-field-select" onchange="updateTriggerOperators(${conditionId})">
                <option value="">Select Field</option>
              </select>
            </div>
            
            <div>
              <label class="form-label" style="margin-bottom: 0.25rem;">Operator</label>
              <select class="form-select-small trigger-operator-select">
                <option value="">Select Operator</option>
              </select>
            </div>
            
            <div>
              <label class="form-label" style="margin-bottom: 0.25rem;">Value</label>
              <input type="text" class="form-input-small trigger-value-input" placeholder="Enter value">
            </div>
          </div>
        </div>
      `;
      
      // Add logic operator before this condition (if not first)
      if (!isFirstCondition) {
        const logicOperatorHTML = `
          <div class="trigger-logic-operator">
            <button type="button" class="logic-operator-btn active" onclick="toggleLogicOperator(this)">AND</button>
            <button type="button" class="logic-operator-btn" onclick="toggleLogicOperator(this)">OR</button>
          </div>
        `;
        conditionsContainer.insertAdjacentHTML('beforeend', logicOperatorHTML);
      }
      
      // Add the condition
      conditionsContainer.insertAdjacentHTML('beforeend', conditionHTML);
      
      // Remove empty state since we now have conditions
      const emptyState = conditionsContainer.querySelector('.trigger-empty-state');
      if (emptyState) {
        emptyState.remove();
      }
    }

    // Remove trigger condition
    function removeTriggerCondition(conditionId) {
      const conditionsContainer = document.getElementById('triggerConditions');
      const condition = document.querySelector(`[data-condition-id="${conditionId}"]`);
      
      if (condition) {
        // Find and remove the logic operator before this condition (if exists)
        const prevElement = condition.previousElementSibling;
        if (prevElement && prevElement.classList.contains('trigger-logic-operator')) {
          prevElement.remove();
        }
        
        // Remove the condition
        condition.remove();
        
        // If this was the last condition and there's a logic operator left, remove it
        const remainingConditions = conditionsContainer.querySelectorAll('.trigger-condition');
        const remainingOperators = conditionsContainer.querySelectorAll('.trigger-logic-operator');
        
        if (remainingConditions.length === 1 && remainingOperators.length > 0) {
          remainingOperators[0].remove();
        }
        
        // Update empty state
        updateTriggerEmptyState();
      }
    }

    // Toggle logic operator (AND/OR)
    function toggleLogicOperator(button) {
      const container = button.parentElement;
      const buttons = container.querySelectorAll('.logic-operator-btn');
      
      // Remove active class from all buttons
      buttons.forEach(btn => btn.classList.remove('active'));
      
      // Add active class to clicked button
      button.classList.add('active');
    }

    // Update trigger fields based on selected object
    function updateTriggerFields(conditionId) {
      const condition = document.querySelector(`[data-condition-id="${conditionId}"]`);
      const objectSelect = condition.querySelector('select');
      const fieldSelect = condition.querySelector('.trigger-field-select');
      const operatorSelect = condition.querySelector('.trigger-operator-select');
      
      const selectedObject = objectSelect.value;
      
      // Clear field and operator selections
      fieldSelect.innerHTML = '<option value="">Select Field</option>';
      operatorSelect.innerHTML = '<option value="">Select Operator</option>';
      
      if (selectedObject && salesforceFieldMappings[selectedObject]) {
        // Add fields for selected object
        salesforceFieldMappings[selectedObject].forEach(field => {
          const option = document.createElement('option');
          option.value = field.value;
          option.textContent = field.label;
          fieldSelect.appendChild(option);
        });
      }
    }

    // Update trigger operators based on selected field
    function updateTriggerOperators(conditionId) {
      const condition = document.querySelector(`[data-condition-id="${conditionId}"]`);
      const fieldSelect = condition.querySelector('.trigger-field-select');
      const operatorSelect = condition.querySelector('.trigger-operator-select');
      
      const selectedField = fieldSelect.value;
      
      // Clear operator selection
      operatorSelect.innerHTML = '<option value="">Select Operator</option>';
      
      if (selectedField) {
        // Determine field type based on field name (simplified logic)
        let fieldType = 'text'; // default
        
        if (selectedField.includes('Amount') || selectedField.includes('Count') || selectedField.includes('Number')) {
          fieldType = 'number';
        } else if (selectedField.includes('Date') || selectedField.includes('Time')) {
          fieldType = 'date';
        } else if (selectedField.includes('Active') || selectedField.includes('Closed') || selectedField.includes('Won')) {
          fieldType = 'boolean';
        }
        
        // Add operators for field type
        operatorOptions[fieldType].forEach(operator => {
          const option = document.createElement('option');
          option.value = operator.value;
          option.textContent = operator.label;
          operatorSelect.appendChild(option);
        });
      }
    }

    // Update trigger empty state
    function updateTriggerEmptyState() {
      const conditionsContainer = document.getElementById('triggerConditions');
      const conditions = conditionsContainer.querySelectorAll('.trigger-condition');
      
      if (conditions.length === 0) {
        conditionsContainer.innerHTML = `
          <div class="trigger-empty-state">
            <svg class="trigger-empty-state-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
            </svg>
            <p>No trigger conditions configured</p>
            <p class="text-xs text-gray-500 mt-1">Add conditions to specify when this summary should run</p>
          </div>
        `;
      }
    }

    // Get trigger conditions data
    function getTriggerConditions() {
      const conditionsContainer = document.getElementById('triggerConditions');
      const conditions = [];
      const elements = conditionsContainer.children;
      
      let currentLogicOperator = 'AND'; // default
      
      for (let i = 0; i < elements.length; i++) {
        const element = elements[i];
        
        if (element.classList.contains('trigger-logic-operator')) {
          // Get the active logic operator
          const activeBtn = element.querySelector('.logic-operator-btn.active');
          currentLogicOperator = activeBtn ? activeBtn.textContent : 'AND';
        } else if (element.classList.contains('trigger-condition')) {
          // Get condition data
          const objectSelect = element.querySelector('select');
          const fieldSelect = element.querySelector('.trigger-field-select');
          const operatorSelect = element.querySelector('.trigger-operator-select');
          const valueInput = element.querySelector('.trigger-value-input');
          
          if (objectSelect.value && fieldSelect.value && operatorSelect.value && valueInput.value.trim()) {
            conditions.push({
              object: objectSelect.value,
              field: fieldSelect.value,
              operator: operatorSelect.value,
              value: valueInput.value.trim(),
              logicOperator: conditions.length > 0 ? currentLogicOperator : null
            });
          }
        }
      }
      
      return conditions;
    }

    // Set trigger conditions data (for editing)
    function setTriggerConditions(triggers) {
      const conditionsContainer = document.getElementById('triggerConditions');
      conditionsContainer.innerHTML = '';
      triggerConditionCounter = 0;
      
      if (!triggers || triggers.length === 0) {
        updateTriggerEmptyState();
        return;
      }
      
      triggers.forEach((trigger, index) => {
        addTriggerCondition();
        
        // Get the last added condition
        const conditions = conditionsContainer.querySelectorAll('.trigger-condition');
        const condition = conditions[conditions.length - 1];
        
        // Set values
        const objectSelect = condition.querySelector('select');
        const fieldSelect = condition.querySelector('.trigger-field-select');
        const operatorSelect = condition.querySelector('.trigger-operator-select');
        const valueInput = condition.querySelector('.trigger-value-input');
        
        objectSelect.value = trigger.object;
        updateTriggerFields(triggerConditionCounter);
        
        setTimeout(() => {
          fieldSelect.value = trigger.field;
          updateTriggerOperators(triggerConditionCounter);
          
          setTimeout(() => {
            operatorSelect.value = trigger.operator;
            valueInput.value = trigger.value;
          }, 50);
        }, 50);
        
        // Set logic operator if not first condition
        if (index > 0 && trigger.logicOperator) {
          const logicOperators = conditionsContainer.querySelectorAll('.trigger-logic-operator');
          const lastOperator = logicOperators[logicOperators.length - 1];
          if (lastOperator) {
            const buttons = lastOperator.querySelectorAll('.logic-operator-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            const targetBtn = Array.from(buttons).find(btn => btn.textContent === trigger.logicOperator);
            if (targetBtn) {
              targetBtn.classList.add('active');
            }
          }
        }
      });
    }

    // Initialize trigger empty state
    document.addEventListener('DOMContentLoaded', function() {
      updateTriggerEmptyState();
    });
  </script>
</body>
</html>
